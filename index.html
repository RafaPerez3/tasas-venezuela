<button id="btn-update" onclick="obtenerDatos()">Actualizar</button>

    <script>
        async function obtenerDatos(reintento = false) {
            const btn = document.getElementById('btn-update');
            const hora = document.getElementById('hora');
            
            if (!reintento) {
                btn.disabled = true;
                btn.innerText = "Cargando...";
                hora.innerText = "Consultando...";
            }

            try {
                // Ponemos un timeout al fetch del frontend tambi√©n (15 segundos)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);

                const res = await fetch('/api/tasas', { signal: controller.signal });
                clearTimeout(timeoutId); // Limpiamos el contador si respondi√≥ a tiempo

                if (!res.ok) throw new Error("Error del servidor");

                const data = await res.json();

                document.getElementById('bcv-usd').innerText = "Bs. " + data.bcv.usd;
                document.getElementById('bcv-eur').innerText = "Bs. " + data.bcv.eur;
                document.getElementById('binance').innerText = "Bs. " + data.binance;
                hora.innerText = "Actualizado: " + data.fecha;
                hora.style.color = "#888"; // Color normal

                btn.disabled = false;
                btn.innerText = "Actualizar";

            } catch (error) {
                console.error(error);
                
                // SI FALLA, LE MOSTRAMOS ESTO AL USUARIO
                hora.innerText = "üò¥ Servidor despertando... (Reintentando)";
                hora.style.color = "#e74c3c"; // Rojo para que se vea
                
                // Truco de SysAdmin: Si falla, esperamos 3 segundos y probamos una vez m√°s autom√°ticamente
                if (!reintento) {
                    setTimeout(() => obtenerDatos(true), 4000);
                } else {
                    hora.innerText = "‚ö†Ô∏è Servidor lento. Dale a 'Actualizar' en 30seg.";
                    btn.disabled = false;
                    btn.innerText = "Reintentar";
                }
            }
        }

        // Cargar al abrir
        obtenerDatos();
    </script>
</body>
</html>